# Спецификация протокола BE RCon версии 2

> Copyright (C) 2011 by BattlEye Innovations

[Оригинальный документ](https://www.battleye.com/downloads/BERConProtocol.txt)

## Общее описание

BE RCon использует сетевой интерфейс игрового сервера, то есть его UDP-порт для игры.  
Из-за ненадежной природы UDP клиент должен заботиться о возможной потере пакетов.

Протокол определяет следующий 7-байтовый заголовок во всех пакетах BE RCon, входящих и исходящих:

```txt
'B'(0x42) | 'E'(0x45) | 4-байтовая контрольная сумма CRC32 последующих байтов | 0xFF
```

Последующие байты (полезная нагрузка) описывают фактический пакет RCon (см. ниже).

## Типы пакетов

Существует 3 различных типа пакетов:

### Пакет входа в систему

Это первый пакет, отправляемый на сервер.
Успешный вход в систему необходим для отправки фактических команд на сервер.

Формат следующий:

```txt
0x00 | пароль (строка ASCII без завершающего нуля)
```

BE RCon сервера, если он включен, подтверждает с помощью следующего пакета:

```txt
0x00 | (0x01 (успешно вошел в систему) ИЛИ 0x00 (неудача))
```

Если сервер не отвечает, BE RCon не включен (пароль не указан).

### Пакет команды

После успешного входа клиента он может отправлять команды BE Server (и возможно команды игрового сервера) на сервер.

Формат следующий:

```txt
0x01 | 1-байтовый номер последовательности (начинается с 0) | команда (строка ASCII без завершающего нуля)
```

BE RCon сервера подтверждает с помощью следующего пакета:

```txt
0x01 | полученный 1-байтовый номер последовательности | (возможный заголовок и/или ответ (строка ASCII без завершающего нуля) ИЛИ ничего)
```

Следующий заголовок существует только в том случае, если сервер отвечает несколькими пакетами из-за ограничений размера пакетов. Заголовок присутствует в каждом из этих пакетов.

```txt
0x00 | количество пакетов для этого ответа | индекс текущего пакета (начиная с 0)
```

Пустой 2-байтовый пакет команды (без фактической строки команды) должен быть отправлен каждые 45 секунд (или меньше) для поддержания соединения/входа в систему активным, если нет других пакетов команд.  
Если клиент не отправляет пакетов команд более чем 45 секунд, он будет удален из списка аутентифицированных клиентов BE RCon и больше не сможет выдавать какие-либо команды.

### Пакет сообщения сервера

Когда BE Server выводит сообщения в консоль сервера, он также отправляет их всем подключенным клиентам RCon.

Формат следующий:

```txt
0x02 | 1-байтовый номер последовательности (начинается с 0) | сообщение сервера (строка ASCII без завершающего нуля)
```

Клиент должен подтвердить с помощью следующего пакета:

```txt
0x02 | полученный 1-байтовый номер последовательности
```

BE RCon сервера пытается отправить пакет сообщения сервера 5 раз в течение 10 секунд. Если клиент не подтверждает пакет в течение этого времени, он будет удален из списка аутентифицированных клиентов BE RCon и больше не сможет выдавать какие-либо команды.
